**Axios ç¼“å­˜æœºåˆ¶æ–‡æ¡£**

æœ¬ç¼“å­˜æœºåˆ¶ä¸º **`Axios`** è¯·æ±‚æä¾›äº†ä¸€ä¸ªé«˜åº¦å¯æ‰©å±•å’Œçµæ´»çš„ç¼“å­˜å±‚ï¼Œåˆ†ä¸ºå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ä¸¤éƒ¨åˆ†ï¼Œå®ç°äº†å†…å­˜ç¼“å­˜ã€æŒä¹…åŒ–ç¼“å­˜ä¸æœåŠ¡ç«¯ç¼“å­˜çš„ç»“åˆã€‚ä»¥ä¸‹æ˜¯å¯¹æ•´ä½“æµç¨‹çš„è¯¦ç»†ä»‹ç»ï¼Œåˆ†ä¸ºå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„ç¼“å­˜ç®¡ç†ã€‚

### 1. **ç¼“å­˜ç­–ç•¥æ¦‚è¿°**

æ‰€æœ‰ç¼“å­˜ç­–ç•¥éƒ½å®ç°äº†ç»Ÿä¸€çš„ **`CacheStrategy`** æ¥å£ï¼ŒåŒ…å«ä»¥ä¸‹æ–¹æ³•ï¼š

- **`get<T>(key: string): Promise<CacheItem<T> | null>`**
- **`set<T>(key: string, value: CacheItem<T>): Promise<void>`**
- **`delete(key: string): Promise<void>`**
- **`clear(): Promise<void>`**
- **`getAll(): Promise<Record<string, CacheItem<any>>>`**

ç¼“å­˜ç±»å‹åŒ…æ‹¬ï¼š

- **å†…å­˜ç¼“å­˜ï¼ˆMemoryCacheï¼‰**ï¼šåŸºäº **`Map`** å®ç°çš„å†…å­˜å­˜å‚¨
- **æŒä¹…åŒ–ç¼“å­˜ï¼ˆPersistentCacheï¼‰**ï¼šåŸºäº **`localStorage`** å®ç°çš„æœ¬åœ°å­˜å‚¨
- **æœåŠ¡ç«¯ç¼“å­˜ï¼ˆServerCacheï¼‰**ï¼šåŸºäº Next.js çš„ **`unstable_cache`** å®ç°çš„æœåŠ¡ç«¯å­˜å‚¨

### 2. **ç¼“å­˜é…ç½®**

#### å®¢æˆ·ç«¯ç¼“å­˜é…ç½®

```ts
const defaultClientCacheConfig = {
  enabled: true,
  ttl: 5 * 60 * 1000, // 5åˆ†é’Ÿ
  persistent: true
}
```

#### æœåŠ¡ç«¯ç¼“å­˜é…ç½®

```ts
const defaultServerCacheConfig = {
  enabled: true,
  revalidate: 5 * 60 * 1000, // 5åˆ†é’Ÿ
  tags: ["api-cache"]
}
```

### 3. **ä½¿ç”¨æ–¹å¼**

#### åŸºæœ¬ç”¨æ³•

```ts
// åœ¨è¯·æ±‚é…ç½®ä¸­æ·»åŠ ç¼“å­˜é€‰é¡¹
const response = await http.get({
  url: "/api/data",
  cache: {
    enabled: true,
    ttl: 300000,
    persistent: true
  }
})
```

#### ç¼“å­˜é”®ç”Ÿæˆ

ç¼“å­˜é”®é»˜è®¤åŸºäºè¯·æ±‚ URL å’Œå‚æ•°è‡ªåŠ¨ç”Ÿæˆï¼š

```ts
const cacheKey = `${config.url}-${JSON.stringify(config.params)}`
```

ä¹Ÿå¯ä»¥åœ¨è¯·æ±‚é…ç½®ä¸­æŒ‡å®šè‡ªå®šä¹‰çš„ç¼“å­˜é”®ï¼š

```ts
const response = await http.get({
  url: "/api/data",
  cache: {
    key: "custom-cache-key"
  }
})
```

### 4. **ç¼“å­˜å¤„ç†æµç¨‹**

#### 1. è¯·æ±‚æ‹¦æˆª

```ts
// æ£€æŸ¥æ˜¯å¦å­˜åœ¨æœ‰æ•ˆç¼“å­˜
const result = await cacheHandler.getCachedData(config)

if (result._cached) {
  // å¦‚æœæœ‰ç¼“å­˜ï¼Œå–æ¶ˆè¯·æ±‚å¹¶è¿”å›ç¼“å­˜æ•°æ®
  return result._cachedData
}
```

#### 2. å“åº”æ‹¦æˆª

```ts
// å­˜å‚¨å“åº”æ•°æ®åˆ°ç¼“å­˜
response = await cacheHandler.setCachedData(response)
```

### 5. **ç¼“å­˜æ¸…ç†æœºåˆ¶**

#### è‡ªåŠ¨æ¸…ç†

- ç³»ç»Ÿæ¯åˆ†é’Ÿè‡ªåŠ¨æ£€æŸ¥å¹¶æ¸…ç†è¿‡æœŸç¼“å­˜
- æ¸…ç†åŒæ—¶ä½œç”¨äºå†…å­˜ç¼“å­˜ã€æŒä¹…åŒ–ç¼“å­˜å’ŒæœåŠ¡ç«¯ç¼“å­˜

#### å­˜å‚¨ç©ºé—´ç®¡ç†ï¼ˆæŒä¹…åŒ–ç¼“å­˜ï¼‰

å½“å­˜å‚¨ç©ºé—´ä¸è¶³æ—¶ï¼š

1. é¦–å…ˆæ¸…ç†è¿‡æœŸç¼“å­˜ï¼ˆé»˜è®¤24å°æ—¶ï¼‰
2. å¦‚æœä»ç„¶ä¸è¶³ï¼Œåˆ™æ¸…ç†æ‰€æœ‰ç¼“å­˜

#### æ‰‹åŠ¨æ¸…ç†

```ts
// æ¸…ç†ç‰¹å®šç¼“å­˜
await cacheHandler.delete(key)

// æ¸…ç†æ‰€æœ‰ç¼“å­˜
await cacheHandler.clear()
```

### 6. **æœåŠ¡ç«¯ç¼“å­˜ç‰¹æ€§**

- ä½¿ç”¨ Next.js çš„ **`unstable_cache`** å’Œ **`revalidateTag`** å®ç°
- æ”¯æŒç¼“å­˜æ ‡ç­¾ï¼ˆtagsï¼‰ç³»ç»Ÿ
- å¯é…ç½®é‡æ–°éªŒè¯æ—¶é—´ï¼ˆrevalidateï¼‰
- ç¼“å­˜æ ‡ç­¾æ ¼å¼ï¼š`http-cache-${key}`

### 7. **è°ƒè¯•ä¿¡æ¯**

ç³»ç»Ÿä¼šè¾“å‡ºè¯¦ç»†çš„ç¼“å­˜æ“ä½œæ—¥å¿—ï¼š

- âœ… ç¼“å­˜å‘½ä¸­ä¿¡æ¯
- ğŸ’¾ ç¼“å­˜å­˜å‚¨ä¿¡æ¯
- ğŸ—‘ï¸ ç¼“å­˜æ¸…ç†ä¿¡æ¯
- âŒ ç¼“å­˜æ“ä½œå¤±è´¥ä¿¡æ¯

### 8. **æ³¨æ„äº‹é¡¹**

1. åªæœ‰ `GET` è¯·æ±‚ä¼šè¢«ç¼“å­˜
2. å®¢æˆ·ç«¯ç¼“å­˜ï¼ˆå†…å­˜å’ŒæŒä¹…åŒ–ï¼‰ä»…åœ¨æµè§ˆå™¨ç¯å¢ƒä¸­å¯ç”¨
3. æœåŠ¡ç«¯ç¼“å­˜åœ¨æ‰€æœ‰ç¯å¢ƒä¸­éƒ½å¯ç”¨
4. ç¼“å­˜é…ç½®å¯ä»¥åœ¨è¯·æ±‚çº§åˆ«è¿›è¡Œè¦†ç›–
5. å»ºè®®ä¸ºé‡è¦çš„ç¼“å­˜æ•°æ®è®¾ç½®è‡ªå®šä¹‰çš„ç¼“å­˜é”®

### 9. **ç±»å‹å®šä¹‰**

```ts
interface CacheConfig {
  enabled?: boolean
  ttl?: number
  persistent?: boolean
  key?: string
  revalidate?: number
  tags?: string[]
}

interface CacheItem<T = any> {
  data: T
  timestamp: number
}
```

### 10. **å®¢æˆ·ç«¯ç¼“å­˜æµç¨‹**

å®¢æˆ·ç«¯ç¼“å­˜åˆ†ä¸ºå†…å­˜ç¼“å­˜ï¼ˆMemoryCacheï¼‰å’ŒæŒä¹…åŒ–ç¼“å­˜ï¼ˆPersistentCacheï¼‰ä¸¤ç§å®ç°ï¼Œå®ƒä»¬éƒ½éµå¾ªç›¸åŒçš„ CacheStrategy æ¥å£ã€‚

#### å†…å­˜ç¼“å­˜ï¼ˆMemoryCacheï¼‰

- ä½¿ç”¨ JavaScript `Map` æ•°æ®ç»“æ„åœ¨å†…å­˜ä¸­å­˜å‚¨æ•°æ®
- é¡µé¢åˆ·æ–°åæ•°æ®ä¼šä¸¢å¤±
- å®ç°ç®€å•ï¼Œè®¿é—®é€Ÿåº¦æœ€å¿«
- é€‚ç”¨äºä¸´æ—¶æ•°æ®çš„å¿«é€Ÿå­˜å–

ç¤ºä¾‹ï¼š

```ts
const memoryCache = new MemoryCache()

await memoryCache.set("key", { data: value, timestamp: Date.now() })

const data = await memoryCache.get("key")
```

#### æŒä¹…åŒ–ç¼“å­˜ï¼ˆPersistentCacheï¼‰

- åŸºäº `localStorage` å®ç°æŒä¹…åŒ–å­˜å‚¨
- æ‰€æœ‰ç¼“å­˜é¡¹éƒ½å¸¦æœ‰ `"http-cache-"` å‰ç¼€
- åŒ…å«è‡ªåŠ¨æ¸…ç†æœºåˆ¶ï¼Œé˜²æ­¢å­˜å‚¨ç©ºé—´æº¢å‡ºï¼š
  1. å½“å­˜å‚¨ç©ºé—´ä¸è¶³æ—¶ï¼Œé¦–å…ˆæ¸…ç†è¿‡æœŸç¼“å­˜ï¼ˆé»˜è®¤ 24 å°æ—¶ï¼‰
  2. å¦‚æœä»ç„¶æ— æ³•å­˜å‚¨ï¼Œåˆ™æ¸…ç†æ‰€æœ‰ç¼“å­˜
- æ•°æ®ä¼šæŒä¹…ä¿å­˜ï¼Œé¡µé¢åˆ·æ–°åä»ç„¶å¯ç”¨

ç¤ºä¾‹ï¼š

```ts
const persistentCache = new PersistentCache()

await persistentCache.set("key", { data: value, timestamp: Date.now() })

const data = await persistentCache.get("key")
```

#### å…±åŒç‰¹æ€§

ä¸¤ç§ç¼“å­˜å®ç°éƒ½æ”¯æŒä»¥ä¸‹æ“ä½œï¼š

- **`get<T>(key)`**: è·å–ç¼“å­˜æ•°æ®
- **`set<T>(key, value)`**: è®¾ç½®ç¼“å­˜æ•°æ®
- **`delete(key)`**: åˆ é™¤æŒ‡å®šç¼“å­˜
- **`clear()`**: æ¸…ç©ºæ‰€æœ‰ç¼“å­˜
- **`getAll()`**: è·å–æ‰€æœ‰ç¼“å­˜æ•°æ®

#### ç¼“å­˜æ¸…ç†æœºåˆ¶

- **å†…å­˜ç¼“å­˜**ï¼šé€šè¿‡ `clear()` æ–¹æ³•ç›´æ¥æ¸…ç©º `Map`
- æŒä¹…åŒ–ç¼“å­˜ï¼š
  - **`clearExpired()`**: æ¸…ç†è¿‡æœŸç¼“å­˜ï¼ˆé»˜è®¤ 24 å°æ—¶ï¼‰
  - **`clear()`**: æ¸…ç†æ‰€æœ‰ä»¥ `"http-cache-"` ä¸ºå‰ç¼€çš„ç¼“å­˜é¡¹
  - å­˜å‚¨ç©ºé—´ä¸è¶³æ—¶çš„è‡ªåŠ¨æ¸…ç†ç­–ç•¥

#### åˆå§‹åŒ–å’Œç¼“å­˜ç­–ç•¥

- å®¢æˆ·ç«¯ä¼šè‡ªåŠ¨åˆå§‹åŒ–å†…å­˜ç¼“å­˜å’ŒæŒä¹…åŒ–ç¼“å­˜ï¼Œå¹¶ä½¿ç”¨ä¸€ä¸ª **`Map`** ç®¡ç†è¿™ä¸¤ç§ç¼“å­˜ç­–ç•¥ã€‚

- å†…å­˜ç¼“å­˜å’ŒæŒä¹…åŒ–ç¼“å­˜çš„é…ç½®åˆ†åˆ«ç”±

  `defaultClientCacheConfig`

  å®šä¹‰ï¼Œå…¶ä¸­ï¼š

  - **`ttl`**ï¼šå®šä¹‰ç¼“å­˜çš„è¿‡æœŸæ—¶é—´ï¼Œå•ä½ä¸ºæ¯«ç§’ï¼ˆé»˜è®¤ä¸º 5 åˆ†é’Ÿï¼‰ã€‚
  - **`persistent`**ï¼šå†³å®šæ˜¯å¦å¯ç”¨æŒä¹…åŒ–ç¼“å­˜ã€‚

#### è¯·æ±‚ç¼“å­˜è·å–ä¸å­˜å‚¨

- **è·å–ç¼“å­˜**ï¼š
  - é€šè¿‡ **`getCachedData`** æ–¹æ³•ï¼Œåˆ¤æ–­å½“å‰è¯·æ±‚æ˜¯å¦ç¬¦åˆç¼“å­˜æ¡ä»¶ï¼ˆå¦‚ï¼š`GET` è¯·æ±‚ï¼‰ã€‚å¦‚æœç¼“å­˜å¯ç”¨ä¸”æœ‰æ•ˆï¼Œåˆ™ç›´æ¥è¿”å›ç¼“å­˜æ•°æ®ã€‚
  - å†…å­˜ç¼“å­˜å’ŒæŒä¹…åŒ–ç¼“å­˜ä¼šæŒ‰ç…§ä¼˜å…ˆçº§è¿›è¡Œæ£€æŸ¥ï¼Œä¼˜å…ˆè¿”å›å†…å­˜ç¼“å­˜ã€‚å¦‚æœå†…å­˜ç¼“å­˜ä¸å­˜åœ¨ï¼Œåˆ™ä¼šæ£€æŸ¥æŒä¹…åŒ–ç¼“å­˜ï¼Œå¹¶å°†æŒä¹…åŒ–ç¼“å­˜åŒæ­¥åˆ°å†…å­˜ç¼“å­˜ä¸­ã€‚
- **ç¼“å­˜å­˜å‚¨**ï¼š
  - é€šè¿‡ **`setCachedData`** æ–¹æ³•ï¼Œå¤„ç†æˆåŠŸçš„ `GET` è¯·æ±‚çš„å“åº”æ•°æ®ï¼Œå°†å…¶å­˜å…¥å†…å­˜ç¼“å­˜åŠå¯é€‰çš„æŒä¹…åŒ–ç¼“å­˜ä¸­ã€‚
  - ç¼“å­˜é¡¹ä¼šä»¥ **`CacheItem`** å¯¹è±¡å­˜å‚¨ï¼ŒåŒ…å«æ•°æ®å’Œæ—¶é—´æˆ³ã€‚

#### ç¼“å­˜æ¸…ç†

ä¸ºé˜²æ­¢ç¼“å­˜å ç”¨è¿‡å¤šèµ„æºï¼Œå®¢æˆ·ç«¯ä¼šå®šæ—¶æ¸…ç†è¿‡æœŸçš„ç¼“å­˜æ•°æ®ã€‚**`cleanup`** æ–¹æ³•æ¯åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡ï¼Œæ£€æŸ¥å†…å­˜ç¼“å­˜å’ŒæŒä¹…åŒ–ç¼“å­˜ä¸­çš„æ•°æ®æ˜¯å¦è¶…æ—¶ï¼Œå¹¶åˆ é™¤è¿‡æœŸæ•°æ®ã€‚

#### ç¼“å­˜å¤±æ•ˆ

æ¯ä¸ªç¼“å­˜é¡¹éƒ½ä¼šé™„å¸¦æ—¶é—´æˆ³ï¼Œç¼“å­˜çš„æœ‰æ•ˆæ€§é€šè¿‡ä¸å½“å‰æ—¶é—´è¿›è¡Œå¯¹æ¯”æ¥åˆ¤æ–­æ˜¯å¦è¿‡æœŸã€‚ç¼“å­˜é¡¹è¿‡æœŸåï¼Œä¼šè¢«è‡ªåŠ¨æ¸…ç†ã€‚

### 11. **æœåŠ¡ç«¯ç¼“å­˜æµç¨‹**

æœåŠ¡ç«¯ç¼“å­˜åŸºäº Next.js çš„ç¼“å­˜æœºåˆ¶å®ç°ï¼Œä½¿ç”¨ **`unstable_cache`** å’Œ **`revalidateTag`** æ¥ç®¡ç†ç¼“å­˜æ•°æ®ã€‚ç¼“å­˜åŒæ—¶å­˜å‚¨åœ¨å†…å­˜ä¸­çš„ `Map` ç»“æ„å’Œ Next.js çš„ç¼“å­˜ç³»ç»Ÿä¸­ã€‚

#### åˆå§‹åŒ–å’Œç¼“å­˜ç­–ç•¥

- æœåŠ¡ç«¯ç¼“å­˜é€šè¿‡ **`ServerCache`** ç±»å®ç°ï¼Œä½¿ç”¨ **`Map`** ç»“æ„åœ¨å†…å­˜ä¸­ç»´æŠ¤ç¼“å­˜æ•°æ®ã€‚
- æ¯ä¸ªç¼“å­˜é¡¹éƒ½ä¼šè¢«èµ‹äºˆä¸€ä¸ªç‰¹å®šçš„æ ‡ç­¾ï¼ˆtagï¼‰ï¼Œæ ¼å¼ä¸º **`http-cache-${key}`**ã€‚
- é»˜è®¤çš„ç¼“å­˜é‡æ–°éªŒè¯æ—¶é—´ä¸º 3600 ç§’ï¼ˆ1å°æ—¶ï¼‰ã€‚

#### è¯·æ±‚ç¼“å­˜è·å–ä¸å­˜å‚¨

- **è·å–ç¼“å­˜**ï¼š
  - é€šè¿‡ **`get`** æ–¹æ³•ä»å†…å­˜ `Map` ä¸­è·å–ç¼“å­˜æ•°æ®ã€‚
  - å¦‚æœç¼“å­˜ä¸å­˜åœ¨ï¼Œè¿”å› `null`ã€‚
- **ç¼“å­˜å­˜å‚¨**ï¼š
  - ä½¿ç”¨ **`set`** æ–¹æ³•åŒæ—¶å°†æ•°æ®å­˜å‚¨åœ¨å†…å­˜ `Map` å’Œ Next.js ç¼“å­˜ä¸­ã€‚
  - å¯ä»¥é€šè¿‡ **`revalidate`** å‚æ•°è®¾ç½®ç¼“å­˜çš„é‡æ–°éªŒè¯æ—¶é—´ã€‚
  - æ”¯æŒä¸ºç¼“å­˜é¡¹è®¾ç½®è‡ªå®šä¹‰æ ‡ç­¾ï¼ˆtagsï¼‰ã€‚

#### ç¼“å­˜æ¸…ç†

ç¼“å­˜æ¸…ç†æœ‰ä¸¤ç§æ–¹å¼ï¼š

- **å•ä¸ªç¼“å­˜é¡¹æ¸…ç†**ï¼šé€šè¿‡ **`delete`** æ–¹æ³•åˆ é™¤æŒ‡å®š `key` çš„ç¼“å­˜ï¼ŒåŒæ—¶ä¼šä½¿å¯¹åº”çš„ **`http-cache-${key}`** æ ‡ç­¾å¤±æ•ˆã€‚
- **å…¨éƒ¨ç¼“å­˜æ¸…ç†**ï¼šé€šè¿‡ **`clear`** æ–¹æ³•æ¸…ç©ºå†…å­˜ `Map`ï¼Œå¹¶ä½¿æ‰€æœ‰å¸¦æœ‰ **`api-cache`** æ ‡ç­¾çš„ç¼“å­˜å¤±æ•ˆã€‚

ç¤ºä¾‹ä»£ç ï¼š

```ts
// è®¾ç½®ç¼“å­˜
await serverCache.set("user-1", userData, 3600, ["users"])

// è·å–ç¼“å­˜
const cachedUser = await serverCache.get("user-1")

// åˆ é™¤æŒ‡å®šç¼“å­˜
await serverCache.delete("user-1")

// æ¸…ç©ºæ‰€æœ‰ç¼“å­˜
await serverCache.clear()
```

### 12. **ç¼“å­˜é…ç½®ä¸è¿‡æœŸæœºåˆ¶**

ç¼“å­˜çš„æœ‰æ•ˆæ€§é€šè¿‡ **`isCacheValid`** æ–¹æ³•è¿›è¡ŒéªŒè¯ï¼Œè¯¥æ–¹æ³•æ¯”è¾ƒç¼“å­˜é¡¹çš„æ—¶é—´æˆ³ä¸å½“å‰æ—¶é—´ï¼Œåˆ¤æ–­ç¼“å­˜æ˜¯å¦å·²ç»è¿‡æœŸã€‚ç¼“å­˜çš„è¿‡æœŸæ—¶é—´ç”± **`ttl`**ï¼ˆå®¢æˆ·ç«¯ï¼‰æˆ– **`revalidate`**ï¼ˆæœåŠ¡ç«¯ï¼‰æ§åˆ¶ï¼Œé»˜è®¤å€¼å‡ä¸º 5 åˆ†é’Ÿã€‚

### 13. **ææ„å’Œæ¸…ç†**

**`CacheHandler`** ç±»æä¾›äº† **`destroy`** æ–¹æ³•ç”¨äºæ¸…ç†ç¼“å­˜ç³»ç»Ÿï¼Œæ¸…é™¤å®šæ—¶å™¨ï¼Œé‡Šæ”¾èµ„æºã€‚

### 14. **ç¼“å­˜é”®çš„ç”Ÿæˆ**

ç¼“å­˜é”®çš„ç”Ÿæˆè§„åˆ™åŸºäºè¯·æ±‚çš„ URL å’ŒæŸ¥è¯¢å‚æ•°ã€‚åœ¨æœåŠ¡ç«¯ç¼“å­˜ä¸­ï¼Œè¿™äº›é”®è¿˜ä¼šè¢«ç”¨æ¥ç”Ÿæˆç‰¹å®šçš„ç¼“å­˜æ ‡ç­¾ï¼Œæ ¼å¼ä¸º **`http-cache-${key}`**ã€‚

---

### æ€»ç»“

æœ¬ç¼“å­˜æœºåˆ¶é€šè¿‡å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ç¼“å­˜çš„åˆç†é…ç½®ä¸ç­–ç•¥ï¼Œå®ç°äº†é«˜æ•ˆã€å¯é çš„æ•°æ®ç¼“å­˜ç®¡ç†ï¼Œæ”¯æŒå¿«é€Ÿæ•°æ®è®¿é—®ã€å‡å°‘é‡å¤è¯·æ±‚åŠæå‡åº”ç”¨æ€§èƒ½ã€‚åœ¨å®¢æˆ·ç«¯ï¼Œæ•°æ®å¯åœ¨å†…å­˜ç¼“å­˜å’ŒæŒä¹…åŒ–ç¼“å­˜ä¹‹é—´åˆ‡æ¢ï¼›è€Œåœ¨æœåŠ¡ç«¯ï¼Œç¼“å­˜å¯ç”¨äºè·¨ä¼šè¯å…±äº«å…¬å…±æ•°æ®ï¼Œä¼˜åŒ–ç³»ç»Ÿæ€§èƒ½ã€‚

### Q&A

### **1. å¦‚ä½•åœ¨ Axios ä¸­å®ç°ç¼“å­˜æœºåˆ¶ï¼Ÿ**

**ç­”ï¼š**
åœ¨ Axios ä¸­å®ç°ç¼“å­˜æœºåˆ¶ï¼Œé€šå¸¸æ˜¯é€šè¿‡æ‹¦æˆªå™¨ï¼ˆinterceptorsï¼‰æ¥å¤„ç†è¯·æ±‚å’Œå“åº”ã€‚å…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š

- **è¯·æ±‚æ‹¦æˆªå™¨**ï¼šåœ¨è¯·æ±‚å‘é€ä¹‹å‰æ£€æŸ¥æ˜¯å¦æœ‰æœ‰æ•ˆçš„ç¼“å­˜ï¼Œå¦‚æœæœ‰åˆ™ç›´æ¥è¿”å›ç¼“å­˜æ•°æ®ï¼Œé¿å…å†æ¬¡è¯·æ±‚ã€‚
- **å“åº”æ‹¦æˆªå™¨**ï¼šåœ¨è¯·æ±‚è¿”å›æ—¶ï¼Œå°†å“åº”æ•°æ®å­˜å…¥ç¼“å­˜ï¼Œä»¥ä¾¿åç»­è¯·æ±‚ä½¿ç”¨ã€‚

ä¾‹å¦‚ï¼Œæ‹¦æˆªå™¨çš„å®ç°å¯èƒ½æ˜¯ï¼š

```ts
axios.interceptors.request.use((config) => {
  // æ£€æŸ¥ç¼“å­˜
  const cachedData = cacheHandler.getCachedData(config)
  if (cachedData) {
    return Promise.resolve({ data: cachedData })
  }
  return config
})

axios.interceptors.response.use((response) => {
  // å­˜å‚¨ç¼“å­˜
  cacheHandler.setCachedData(response)
  return response
})
```

### **2. ä½ æ˜¯å¦‚ä½•å¤„ç†ç¼“å­˜å¤±æ•ˆçš„ï¼Ÿç¼“å­˜è¿‡æœŸåå¦‚ä½•é‡æ–°å‘èµ·è¯·æ±‚ï¼Ÿ**

**ç­”ï¼š**
ç¼“å­˜å¤±æ•ˆé€šå¸¸é€šè¿‡è®¾ç½® **TTLï¼ˆTime To Liveï¼Œå­˜æ´»æ—¶é—´ï¼‰** æ¥å®ç°ã€‚æ¯æ¬¡è¯·æ±‚æ—¶éƒ½ä¼šæ£€æŸ¥ç¼“å­˜çš„æœ‰æ•ˆæ€§ï¼Œå¦‚æœç¼“å­˜å·²ç»è¿‡æœŸï¼Œç¼“å­˜ä¼šè¢«æ¸…é™¤å¹¶é‡æ–°å‘èµ·è¯·æ±‚ã€‚
å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼åˆ¤æ–­ç¼“å­˜æ˜¯å¦æœ‰æ•ˆï¼š

```ts
function isCacheValid(timestamp, ttl) {
  return Date.now() - timestamp < ttl
}
```

å¦‚æœç¼“å­˜å¤±æ•ˆï¼Œç³»ç»Ÿä¼šé‡æ–°è¯·æ±‚æ•°æ®å¹¶æ›´æ–°ç¼“å­˜ã€‚ä¸€èˆ¬ä¼šé€šè¿‡å®šæ—¶æ¸…ç†ç¼“å­˜å’Œé‡æ–°å‘èµ·è¯·æ±‚çš„æ–¹å¼æ¥ç¡®ä¿æ•°æ®çš„æœ€æ–°æ€§ã€‚

### **3. åœ¨ Axios ç¼“å­˜æœºåˆ¶ä¸­ï¼Œå¦‚ä½•ç®¡ç†å¤šä¸ªç¼“å­˜ç­–ç•¥ï¼ˆå¦‚å†…å­˜ç¼“å­˜ã€æŒä¹…åŒ–ç¼“å­˜ã€æœåŠ¡ç«¯ç¼“å­˜ï¼‰ï¼Ÿ**

**ç­”ï¼š**
åœ¨å®ç°ç¼“å­˜æ—¶ï¼Œå¯ä»¥ä¸ºä¸åŒçš„ç¼“å­˜ç±»å‹é€‰æ‹©ä¸åŒçš„ç¼“å­˜ç­–ç•¥ï¼Œå¸¸è§çš„æœ‰ï¼š

- **å†…å­˜ç¼“å­˜**ï¼šä½¿ç”¨æµè§ˆå™¨çš„å†…å­˜æ¥å­˜å‚¨ç¼“å­˜æ•°æ®ï¼Œé€‚ç”¨äºçŸ­æœŸå­˜å‚¨ï¼Œå¯ä»¥é€šè¿‡ `Map` æˆ–å¯¹è±¡å®ç°ã€‚
- **æŒä¹…åŒ–ç¼“å­˜**ï¼šå°†ç¼“å­˜æ•°æ®å­˜å‚¨åœ¨æœ¬åœ°å­˜å‚¨ï¼ˆ`localStorage`ã€`sessionStorage`ï¼‰ä¸­ï¼Œé€‚ç”¨äºéœ€è¦åœ¨ç”¨æˆ·ä¼šè¯ä¹‹é—´æŒä¹…åŒ–çš„ç¼“å­˜ã€‚
- **æœåŠ¡ç«¯ç¼“å­˜**ï¼šå°†æ•°æ®å­˜å‚¨åœ¨æœåŠ¡å™¨ç«¯ç¼“å­˜ä¸­ï¼Œä¾‹å¦‚ Redisï¼Œé€‚ç”¨äºè·¨ä¼šè¯å’Œè·¨ç”¨æˆ·çš„æ•°æ®ç¼“å­˜ã€‚

ä½ å¯ä»¥é€šè¿‡ `CacheHandler` ç±»æ¥åˆ†åˆ«ç®¡ç†è¿™äº›ç¼“å­˜ç­–ç•¥ï¼Œå¹¶é€‰æ‹©åˆé€‚çš„ç¼“å­˜ç±»å‹ï¼š

```ts
const strategies = new Map()
strategies.set("memory", new MemoryCache())
strategies.set("persistent", new PersistentCache())
strategies.set("server", new ServerCache())
```

æ ¹æ®è¯·æ±‚ç±»å‹ï¼ŒåŠ¨æ€é€‰æ‹©åˆé€‚çš„ç¼“å­˜ç­–ç•¥ã€‚

### **4. å¦‚ä½•ç”Ÿæˆç¼“å­˜é”®ï¼Œå¹¶ç¡®ä¿ç¼“å­˜é”®çš„å”¯ä¸€æ€§ï¼Ÿ**

**ç­”ï¼š**
ç¼“å­˜é”®ç”¨äºå”¯ä¸€æ ‡è¯†ç¼“å­˜æ•°æ®ï¼Œç”Ÿæˆç¼“å­˜é”®æ—¶é€šå¸¸ä¼šè€ƒè™‘è¯·æ±‚çš„ URL å’ŒæŸ¥è¯¢å‚æ•°ã€‚å¯ä»¥æ ¹æ®è¯·æ±‚çš„ URLã€æ–¹æ³•ã€å‚æ•°ç­‰ä¿¡æ¯æ¥æ„é€ ä¸€ä¸ªç‹¬ç‰¹çš„ç¼“å­˜é”®ã€‚ä¾‹å¦‚ï¼š

```ts
const generateCacheKey = (config) => {
  return `${config.url}-${JSON.stringify(config.params)}`
}
```

è¿™ç§æ–¹å¼èƒ½å¤Ÿç¡®ä¿ç¼“å­˜é”®çš„å”¯ä¸€æ€§ï¼Œé¿å…ä¸åŒè¯·æ±‚ä¹‹é—´çš„ç¼“å­˜å†²çªã€‚ä¸ºäº†æ›´å¥½åœ°ç®¡ç†ç¼“å­˜é”®ï¼Œå¯ä»¥å°†å…¶å­˜å‚¨åœ¨å†…å­˜ã€æŒä¹…åŒ–å­˜å‚¨æˆ–æœåŠ¡ç«¯ç¼“å­˜ä¸­ã€‚

### **5. ä½ æ˜¯å¦‚ä½•å®ç°ç¼“å­˜æ¸…ç†çš„ï¼Ÿå¦‚ä½•å®šæœŸæ¸…ç†è¿‡æœŸçš„ç¼“å­˜æ•°æ®ï¼Ÿ**

**ç­”ï¼š**
ç¼“å­˜æ¸…ç†å¯ä»¥é€šè¿‡è®¾ç½®å®šæ—¶ä»»åŠ¡æ¥å®šæœŸæ£€æŸ¥å¹¶åˆ é™¤è¿‡æœŸçš„ç¼“å­˜æ•°æ®ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œæ¸…ç†æœºåˆ¶é€šè¿‡æ£€æŸ¥ç¼“å­˜é¡¹çš„æ—¶é—´æˆ³ä¸å½“å‰æ—¶é—´çš„å·®å€¼ï¼Œåˆ¤æ–­ç¼“å­˜æ˜¯å¦è¿‡æœŸã€‚å¯ä»¥ä½¿ç”¨ `setInterval` æ¥æ¯éš”ä¸€æ®µæ—¶é—´æ‰§è¡Œæ¸…ç†æ“ä½œï¼š

```ts
setInterval(() => {
  cleanup()
}, 60 * 1000) // æ¯åˆ†é’Ÿæ¸…ç†ä¸€æ¬¡
```

åœ¨ `cleanup` æ–¹æ³•ä¸­ï¼Œä¼šéå†æ‰€æœ‰ç¼“å­˜æ•°æ®ï¼Œåˆ¤æ–­ç¼“å­˜æ˜¯å¦è¿‡æœŸï¼Œè¿‡æœŸçš„ç¼“å­˜ä¼šè¢«åˆ é™¤ï¼š

```ts
async function cleanup() {
  const allCaches = await cacheHandler.getAllCaches()
  for (const [key, cache] of Object.entries(allCaches)) {
    if (!isCacheValid(cache.timestamp, cache.ttl)) {
      await cacheHandler.deleteCache(key)
      console.log(`æ¸…ç†è¿‡æœŸç¼“å­˜ï¼š${key}`)
    }
  }
}
```

è¿™ç§æ–¹å¼ä¿è¯äº†ç¼“å­˜ä¸ä¼šæ— é™åˆ¶ç§¯ç´¯ï¼Œé¿å…å†…å­˜æˆ–å­˜å‚¨çš„æµªè´¹ã€‚
